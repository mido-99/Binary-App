{% extends "base.html" %}

{% block title %}Store ¬∑ Binary Referral Commerce{% endblock %}

{% block content %}
<div class="space-y-10">
    <section class="text-center sm:text-left">
        <h1 class="font-heading text-3xl sm:text-4xl font-bold tracking-tight text-[hsl(var(--fg))]">
            Shop
        </h1>
        <p class="mt-2 text-[hsl(var(--muted-fg))] text-base sm:text-lg max-w-2xl">
            Browse products from our stores. Every purchase supports the referral network.
        </p>
    </section>

    <section class="flex flex-col sm:flex-row gap-4 flex-wrap items-stretch sm:items-end justify-between gap-y-4">
        <form method="get" action="{% url 'storefront:home' %}" class="flex flex-wrap gap-3 items-center flex-1 min-w-0">
            <input type="hidden" name="sort" value="{{ current_sort }}">
            {% if current_category %}<input type="hidden" name="category" value="{{ current_category }}">{% endif %}
            <label class="sr-only" for="q">Search products</label>
            <input type="search"
                   id="q"
                   name="q"
                   value="{{ search_query }}"
                   placeholder="Search products‚Ä¶"
                   class="input-modern flex-1 min-w-[200px] max-w-md" />
            <button type="submit" class="btn-primary rounded-lg shrink-0">
                Search
            </button>
        </form>
        <div class="flex flex-wrap gap-3 items-center">
            <form method="get" class="flex items-center gap-2">
                {% if search_query %}<input type="hidden" name="q" value="{{ search_query }}">{% endif %}
                <label for="category" class="text-sm text-[hsl(var(--muted-fg))] shrink-0">Category</label>
                <select name="category" id="category" onchange="this.form.submit()"
                        class="input-modern min-w-[140px] cursor-pointer">
                    <option value="">All</option>
                    {% for value, label in categories %}
                        <option value="{{ value }}" {% if current_category == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
                <input type="hidden" name="sort" value="{{ current_sort }}">
            </form>
            <form method="get" class="flex items-center gap-2">
                {% if search_query %}<input type="hidden" name="q" value="{{ search_query }}">{% endif %}
                {% if current_category %}<input type="hidden" name="category" value="{{ current_category }}">{% endif %}
                <label for="sort" class="text-sm text-[hsl(var(--muted-fg))] shrink-0">Sort</label>
                <select name="sort" id="sort" onchange="this.form.submit()"
                        class="input-modern min-w-[160px] cursor-pointer">
                    <option value="newest" {% if current_sort == "newest" %}selected{% endif %}>Newest</option>
                    <option value="price_asc" {% if current_sort == "price_asc" %}selected{% endif %}>Price: low ‚Üí high</option>
                    <option value="price_desc" {% if current_sort == "price_desc" %}selected{% endif %}>Price: high ‚Üí low</option>
                    <option value="name" {% if current_sort == "name" %}selected{% endif %}>Name A‚ÄìZ</option>
                </select>
            </form>
        </div>
    </section>

    <section>
        {% if products %}
            <ul class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 sm:gap-8" role="list">
                {% for product in products %}
                    <li class="group">
                        <a href="#" class="block h-full glass-card rounded-2xl overflow-hidden card-lift p-0 border border-[hsl(var(--border))]">
                            <div class="aspect-square bg-[hsl(var(--muted)/0.5)] flex items-center justify-center text-[hsl(var(--muted-fg))] text-5xl font-heading font-bold group-hover:bg-[hsl(var(--muted))] transition-colors duration-200">
                                {{ product.name|slice:":1"|upper }}
                            </div>
                            <div class="p-5">
                                <span class="text-xs font-semibold uppercase tracking-wider text-[hsl(var(--primary))]">
                                    {{ product.get_category_display }}
                                </span>
                                <h2 class="mt-2 font-heading text-xl font-bold text-[hsl(var(--fg))] group-hover:text-[hsl(var(--primary))] transition-colors duration-200">
                                    {{ product.name }}
                                </h2>
                                <p class="mt-2 text-sm text-[hsl(var(--muted-fg))] line-clamp-2 min-h-[2.5rem]">
                                    {{ product.description|default:"No description."|truncatewords:14 }}
                                </p>
                                <div class="mt-4 flex items-baseline justify-between gap-2">
                                    <span class="font-heading text-2xl font-bold text-[hsl(var(--fg))]">
                                        ${{ product.markup_price }}
                                    </span>
                                    <span class="text-xs text-[hsl(var(--muted-fg))] truncate">
                                        {{ product.store.name }}
                                    </span>
                                </div>
                            </div>
                        </a>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <div class="glass-card rounded-2xl border border-[hsl(var(--border))] p-12 sm:p-16 text-center">
                <div class="max-w-sm mx-auto">
                    <div class="w-16 h-16 rounded-2xl bg-[hsl(var(--muted))] flex items-center justify-center text-[hsl(var(--muted-fg))] text-2xl mx-auto mb-4" aria-hidden="true">üîç</div>
                    <h2 class="font-heading text-xl font-bold text-[hsl(var(--fg))]">No products found</h2>
                    <p class="mt-2 text-[hsl(var(--muted-fg))] text-sm">
                        No products match your filters. Try a different category or search.
                    </p>
                    <a href="{% url 'storefront:home' %}" class="mt-6 inline-block btn-primary rounded-lg">
                        Clear filters
                    </a>
                </div>
            </div>
        {% endif %}
    </section>
</div>
{% endblock %}
